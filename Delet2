import paho.mqtt.client as mqtt
import yaml
import json
import os

"""
this code will subscriber to the mqtt topic sent by IOT Manager then send an suspicious info via MQTT topic to the Task manager
"""

# mqtt_config_file = "/app/augmented-robots/server/nux_ws/src/IOT_Manager/Suspicious_extension/config/config_file.yaml"

def load_config(filename):

    base_path = os.path.dirname(__file__)
    config_path = os.path.join(base_path , 'config' , filename)
    with open(config_path , 'r') as file :

        return yaml.safe_load(file)


config = load_config('mqtt_config.yaml')
print(config)
mqtt_settings = config['mqtt_settings']

def on_connect(client, userdata, flags, rc):
    print("Connected with result code "+str(rc))
    client.subscribe(mqtt_settings['mqtt_topic_sub'])


def on_message(client, userdata, msg):

    message = msg.payload.decode("utf-8")
    print(f"Received '{message}' from topic '{msg.topic}'")
    try:
        data = json.loads(message)
        if data["data"]["category"] == "Ding" :

            # if "Key" in data and data["Key"] == "something" :
            response = "Triger action based on recieved msg"

            # client.publish(mqtt_settings['mqtt_topic_pub'], response)
            print(response)

        else:

            print("not")

    except json.JSONDecodeError as e:
        print(f"Error: {e}")
def main():

    client = mqtt.Client()
    client.on_connect = on_connect
    client.on_message = on_message

    client.connect(mqtt_settings['mqtt_brocker'] , mqtt_settings['mqtt_port'] , 60)
    client.loop_forever()

if __name__ == "__main__" :
    main()

I get 

/bin/python3 /app/augmented-robots/server/nux_ws/src/IOT_Manager/Suspicious_extension/suspicious_info.py
{'mqtt_settings': {'mqtt_brocker': '192.168.10.143', 'mqtt_port': 1883, 'mqtt_topic_sub': 'homein/#', 'mqtt_topic_pub': '/suspicious'}}
Exception ignored in: <function Client.__del__ at 0x7fcb6750cb80>
Traceback (most recent call last):
  File "/home/orange/.local/lib/python3.8/site-packages/paho/mqtt/client.py", line 874, in __del__
    self._reset_sockets()
  File "/home/orange/.local/lib/python3.8/site-packages/paho/mqtt/client.py", line 1133, in _reset_sockets
    self._sock_close()
  File "/home/orange/.local/lib/python3.8/site-packages/paho/mqtt/client.py", line 1119, in _sock_close
    if not self._sock:
AttributeError: 'Client' object has no attribute '_sock'
Traceback (most recent call last):
  File "/app/augmented-robots/server/nux_ws/src/IOT_Manager/Suspicious_extension/suspicious_info.py", line 60, in <module>
    main()
  File "/app/augmented-robots/server/nux_ws/src/IOT_Manager/Suspicious_extension/suspicious_info.py", line 52, in main
    client = mqtt.Client()
TypeError: __init__() missing 1 required positional argument: 'callback_api_version'
